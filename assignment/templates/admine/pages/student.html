{% extends 'admine/pages/base.html' %}


{% block content %} 


<div class="pagetitle">
    <h1>Dashboard</h1>
    <nav>
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="index.html">Home</a></li>
        <li class="breadcrumb-item active">Dashboard</li>
      </ol>
    </nav>
   </div><!-- End Page Title -->
<section class="section dashboard">
         
    <div class="row">
     
<div class="col-12">

<div class="card recent-sales overflow-auto">
    
  
  <div class="filter">
    <a class="icon" href="#" data-bs-toggle="dropdown"><i class="bi bi-three-dots"></i></a>
    <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
      <li class="dropdown-header text-start">
        <h6>Filter</h6>
      </li>

      <li><a class="dropdown-item" href="#">Today</a></li>
      <li><a class="dropdown-item" href="#">This Month</a></li>
      <li><a class="dropdown-item" href="#">This Year</a></li>
    </ul>
  </div>

  <div class="card-body">
    <h5 class="card-title">Recent Sales <span>| Today</span></h5>
    <!--button ajouter-->
     <a href="#" class="ajouter"  data-toggle="modal" data-target="#addModal" >
        <!--<button type="button"  class="btn btn-primary btn-sm float-right rounded-circle mb-1 ">-->
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40"  fill="currentColor" class="bi bi-plus-circle float-right" viewBox="0 0 16 16">
           <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
           <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
         </svg>
        
          <!--</button>-->
     </a>
     <!-- end button ajouter-->
    <table class="table table-borderless datatable" id="table_student">
      <thead>
        <tr>
          <th scope="col">id</th>
          <th scope="col">Name</th>
          <th scope="col">Email</th>
          <th scope="col">Groupe</th>
          <th scope="col">Status</th>
          <th scope="col">Action</th>
        </tr>
      </thead>
      <tbody>
        {% for student in students %}
          <tr>
          <td class="row-name" data-target="aloooo" scope="row"><a href="#">{{student.id}}</a></td>
          <td class="row-class" scope="row"><a href="#">{{student.name}}</a></td>
          <td class="row-email">{{student.email}}</td>
          <td class="row-product"><a href="#" class="text-primary">{{student.group_id.name}}</a></td>
          <td class="row-status"><span class="badge bg-success">Approved</span></td>
          <td>

            <a class="view-or-edite" data-toggle="modal" data-target="#editModal" href="" id="{student}"><i class="bi bi-pen  "></i></a>

            &nbsp; &nbsp;

           <a class="delete"  data-toggle="modal" data-wewe="{{student.id}}" data-target="#deleteModal" data href=""><i class="bi bi-trash "></i></a>

              </i>&nbsp; &nbsp;

           <a class="view-or-edite"  data-toggle="modal" data-target="#detailsModal"  href="#"><i class="bi bi-eye " ></i></a>
        </td>
        </tr>
        {% endfor %}

        

      </tbody>
    </table>

      
  </div>
</div>
</div><!-- End Recent Sales -->
</div>


</section>

   <!-- Modal  details-->
<div class="modal fade" id="detailsModal" tabindex="-1" role="dialog" aria-labelledby="detailsModalLabel" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered" role="document">
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title" id="detailsModalLabel">Row Details</h5>
      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <!-- form details -->
                    <form class="details-or-view-form" >
                        <div class="form-group">
                        <label for="name">Name</label>
                        <input type="text" class="form-control name" id="name" placeholder="Enter name">
                        </div>
                        <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" class="form-control email" id="email" placeholder="Enter email">
                        </div>
                        <div class="form-group">
                        <label for="product">Product</label>
                        <input type="text" class="form-control product" id="product" placeholder="Enter product">
                        </div>
                        <div class="form-group">
                        <label for="price">Price</label>
                        <input type="text" class="form-control price" id="price" placeholder="Enter price">
                        </div>
                        <div class="form-group">
                        <label for="status">Status</label>
                        <select class="form-control status" id="status">
                            <option>Active</option>
                            <option>Inactive</option>
                        </select>
                        </div>
                        
                    </form>
<!-- form details -->
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
    </div>
  </div>
</div>
</div>
<!-- End Modal details -->

<!-- Delete Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
<div  class="modal-dialog modal-dialog-centered" role="document">
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title" id="deleteModalLabel">Delete Confirmation</h5>
      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      Are you sure you want to delete this item?
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
      <button type="button" id="submit_deleteStudent" class="btn btn-danger" onclick="deleteItem()" data-dismiss="modal">Delete</button>
    </div>
  </div>
</div>
</div>
<!-- End Delete Modal -->

<!-- Edit Modal -->
<div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered"  role="document">
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title" id="editModalLabel">Edit Item</h5>
      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
   
    <div class="modal-body">
         <!-- form details -->
         <form class="details-or-view-form" method="PUT">
            <div class="form-group">
            <label for="name">id</label>
            <input type="text" class="form-control name" id="id_to_update" placeholder="Enter id">
            </div>
            <div class="form-group">
            <label for="name">name</label>
            <input type="text" class="form-control name" id="name_to_update" placeholder="Enter name">
            </div>
            <div class="form-group">
            <label for="email">email</label>
            <input type="email" class="form-control email " id="email_to_update" placeholder="Enter email">
            </div>
            <div class="form-group">
            <label for="price">groupe</label>
            <input type="text" class="form-control price" id="groupe_to_update" placeholder="Enter groupe">
            </div>
            <div class="form-group">
            <label for="status">Status</label>
            <select class="form-control status" id="status">
                <option>Active</option>
                <option>Inactive</option>
            </select>
            </div>
           </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
      <button type="submit" href="{% url 'student' %}" id="update_student" class="btn btn-primary" onclick="saveChanges()" data-dismiss="modal">Save Changes</button>
    </div>
        </form>
<!-- form details -->
      <!-- Form for editing item goes here -->
    
  </div>
</div>
</div>
<!-- End Edit Modal -->


<!-- add Modal -->
<div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="addModalLabel" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered"  role="document">
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title" id="addModalLabel">Add Item</h5>
      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body" id="formwrapper">
         <!-- form details -->
        <form id="addStudents"  method='POST' >
          {% csrf_token %}
          
            <div class="form-group">
              <label for="name">Name</label>
              <input type="text" name="name" class="form-control name" id="student_name" placeholder="Enter name">
            </div>
            <div class="form-group">
              <label for="email">Email</label>
              <input type="email" name="email" class="form-control email" id="student_email" placeholder="Enter email">
            </div>
            <div class="form-group">
              <label for="groupe">groupe</label>
              <select class="form-control status" name="group_id" id="groupe">
                {% comment %} for block {% endcomment %}
                {% for option in options_list_groups %}
                  <option value="{{ option.id }}">{{ option.name }}</option>
                {% endfor %}
            </select>
            </div>  
            
            <div class="form-group">
              <label for="matiere">matiere</label>
              <select class="form-control status" name="matiere" id="matiere">
                {% comment %} for block {% endcomment %}
                {% for option in options_list_matieres %}
                  <option value="{{ option.id }}">{{ option.name }}</option>
                {% endfor %}
            </select>
            </div>


            {% comment %} <div class="form-group">
              <label for="status">Status</label>
              <select class="form-control status" id="status">
                  <option value="">Active</option>
                  <option>Inactive</option>
              </select>
            </div> {% endcomment %}
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
              <input id='submit_add_student' type="submit" value="submit" class="btn btn-primary add_item" data-dismiss="modal" />
            </div>
        </form>
<!-- form details -->
      <!-- Form for editing item goes here -->
    </div>
    {% comment %} <div class="modal-footer">
      <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
      <button type="submit" class="btn btn-primary add_item" data-dismiss="modal">add new item</button>
    </div> {% endcomment %}
  </div>
  </div>
</div>

<script type="text/javascript">

  $(document).ready(function() {
 $(".view-or-edite").click(function() {
   // Get the row element
   var target = $(this).attr('data-target');
              console.log(target);
       if(target=="#detailsModal")
      {
          $(".details-or-view-form input").prop("readonly", true);   
      }
      else if(target=="#editModal")
      {
          $(".details-or-view-form input").prop("readonly", false);
      }
  
   var row = $(this).closest("tr");
   // Get the values of each cell in the row
   var cell1 = row.find("td:eq(0)").text();
   var cell2 = row.find("td:eq(1)").text();
   var cell3 = row.find("td:eq(2)").text();
   var cell4 = row.find("td:eq(3)").text();
   var cell5 = row.find("td:eq(4)").text();
   // Display the values in the modal
      const form_classes = ['name', 'email','product','price','status'];
      const cells =[cell1,cell2,cell3,cell4,cell5];

      form_classes.forEach(function(form_class, i) {
      const inputs = document.querySelectorAll(`.details-or-view-form input[id='${form_class}']`);
     
    
      
      for (const input of inputs) {     
          
          input.value = cells[i];
      }
      });

 })}
); 





function getCookie(name) {
  var cookieValue = null;
  if (document.cookie && document.cookie !== '') {
      var cookies = document.cookie.split(';');
      for (var i = 0; i < cookies.length; i++) {
          var cookie = cookies[i].trim();
          // Does this cookie string begin with the name we want?
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
              cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
              break;
          }
      }
  }
  return cookieValue;
}
var csrftoken = getCookie('csrftoken');





// update student 

$(document).ready(function() {
  $("#update_student").click(function(e) {
      console.log("u entered to update student api");
      e.preventDefault()
      var id = document.getElementById('id_to_update').value
      var name = document.getElementById('name_to_update').value
      var email = document.getElementById('email_to_update').value
      var groupe = document.getElementById('groupe_to_update').value
      console.log(id, name, email, groupe);

      let url = `http://127.0.0.1:8000/students/put_delete_Student/${id}`

      fetch(url, {
          method: 'PUT',
          headers: {
              'Content-type': 'application/json',
              'X-CSRFToken': csrftoken,
          },

          body: JSON.stringify({
              'name': name,
              'email': email,
              'group_id': groupe,
          })
      }).then(function(response) {
          console.log('response', response)
      })
      setTimeout(() => {
        location.reload();
    }, 1000);


  })
})



//  add new student

$(document).ready(function() {
  $("#submit_add_student").click(function(e) {
      console.log("u entered to add student api");
      e.preventDefault()
      var name = document.getElementById('student_name').value
      var email = document.getElementById('student_email').value
      var groupe = document.getElementById('groupe').value
      var matiere = document.getElementById('matiere').value
      console.log(name, email, groupe, matiere);

      let url = 'http://127.0.0.1:8000/students/add_list_students/'

      fetch(url, {
          method: 'POST',
          headers: {
              'Content-type': 'application/json',
              'X-CSRFToken': csrftoken,
          },

          body: JSON.stringify({
              'name': name,
              'email': email,
              'group_id': groupe,
              'matiere': matiere
          })
      }).then(function(response) {
          console.log('response', response)
      })
      setTimeout(() => {
        location.reload();
    }, 1000);


  })
})


// # delete student
let id_question_to_remove 
$(document).ready(function() {
  $(".delete").click(function() {
    // Get the row element
   id_question_to_remove = $(this).attr('data-wewe');
    console.log(id_question_to_remove);
})})

$(document).ready(function() {
  $("#submit_deleteStudent").click(function(e) {
      console.log("u entered");
    
      console.log(id_question_to_remove);
      console.log(csrftoken)
      e.preventDefault()
      

      var url = `http://127.0.0.1:8000/students/put_delete_Student/${id_question_to_remove}`

      fetch(url, {
          method: 'DELETE',
          headers: {
              'Content-type': 'application/json',
              'X-CSRFToken': csrftoken,
          },
          body: JSON.stringify({

          })
      }).then(function(response) {
          console.log('response', response)
          console.log('remmmoooovveeedd hahahah')
      })
      
      setTimeout(() => {
        location.reload();
    }, 1000);
    
      


  })
})

</script>
{% endblock content %}


